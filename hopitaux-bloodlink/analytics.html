<!DOCTYPE html>
<html lang="fr" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytiques Avanc√©es | BloodLink Pro</title>
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Palette M√©dicale Professionnelle */
            --primary-blue: #1a5f7a;
            --secondary-blue: #2d8fbb;
            --accent-blue: #57c1eb;
            --light-blue: #e8f4f8;
            --medical-teal: #008b8b;
            --emergency-red: #e63946;
            --success-green: #2a9d8f;
            --warning-orange: #f4a261;
            --soft-purple: #9d4edd;
            --data-science: #7209b7;
            
            /* Neutres */
            --pure-white: #ffffff;
            --snow-white: #f8fafc;
            --crystal-gray: #f1f5f9;
            --ice-gray: #e2e8f0;
            --slate-gray: #64748b;
            --charcoal: #334155;
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            --gradient-analytics: linear-gradient(135deg, var(--data-science) 0%, var(--soft-purple) 100%);
            --gradient-emergency: linear-gradient(135deg, var(--emergency-red) 0%, #ff6b6b 100%);
            --gradient-success: linear-gradient(135deg, var(--success-green) 0%, #4cc9f0 100%);
            
            /* Ombres */
            --shadow-sm: 0 2px 8px rgba(26, 95, 122, 0.08);
            --shadow-md: 0 4px 16px rgba(26, 95, 122, 0.12);
            --shadow-lg: 0 8px 32px rgba(26, 95, 122, 0.16);
            --shadow-xl: 0 16px 48px rgba(26, 95, 122, 0.2);
            
            /* Bordures */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--snow-white) 0%, var(--light-blue) 100%);
            color: var(--charcoal);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ====== HEADER HOSPITALIER ====== */
        .hospital-header {
            background: var(--pure-white);
            border-bottom: 1px solid var(--ice-gray);
            box-shadow: var(--shadow-sm);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 70px;
            display: flex;
            align-items: center;
        }
        
        .header-container {
            width: 100%;
            max-width: 100%;
            padding: 0 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        /* Logo M√©dical */
        .medical-logo {
            display: flex;
            align-items: center;
            gap: 16px;
            text-decoration: none;
        }
        
        .logo-icon {
            width: 44px;
            height: 44px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .logo-icon i {
            color: var(--pure-white);
            font-size: 1.5rem;
            animation: heartbeat 2s ease-in-out infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
        }
        
        .logo-text h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-blue);
            line-height: 1;
            letter-spacing: -0.5px;
        }
        
        .logo-text span {
            font-size: 0.75rem;
            color: var(--secondary-blue);
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        /* Navigation Principale */
        .main-nav {
            display: flex;
            gap: 4px;
            margin-left: 48px;
        }
        
        .nav-item {
            padding: 12px 24px;
            text-decoration: none;
            color: var(--slate-gray);
            font-weight: 500;
            font-size: 0.95rem;
            border-radius: var(--radius-md);
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        
        .nav-item:hover {
            color: var(--primary-blue);
            background: rgba(45, 143, 187, 0.08);
        }
        
        .nav-item.active {
            color: var(--primary-blue);
            background: rgba(45, 143, 187, 0.12);
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 24px;
            right: 24px;
            height: 3px;
            background: var(--secondary-blue);
            border-radius: var(--radius-full);
        }
        
        /* Actions Droite */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        /* Recherche M√©dicale */
        .search-wrapper {
            position: relative;
        }
        
        .search-input {
            padding: 10px 16px 10px 44px;
            border: 1px solid var(--ice-gray);
            border-radius: var(--radius-full);
            width: 280px;
            font-size: 0.9rem;
            transition: all var(--transition-base);
            background: var(--crystal-gray);
            color: var(--charcoal);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(87, 193, 235, 0.1);
            width: 320px;
            background: var(--pure-white);
        }
        
        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--slate-gray);
            pointer-events: none;
        }
        
        /* Notifications */
        .notification-wrapper {
            position: relative;
        }
        
        .notification-btn {
            width: 42px;
            height: 42px;
            border-radius: var(--radius-md);
            border: 1px solid var(--ice-gray);
            background: var(--pure-white);
            color: var(--slate-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
            position: relative;
            cursor: pointer;
        }
        
        .notification-btn:hover {
            background: var(--crystal-gray);
            color: var(--secondary-blue);
            border-color: var(--accent-blue);
        }
        
        .notification-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: var(--gradient-emergency);
            color: var(--pure-white);
            font-size: 0.7rem;
            font-weight: 700;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--pure-white);
            box-shadow: var(--shadow-sm);
            animation: badgePulse 2s infinite;
        }
        
        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Profil Utilisateur */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 8px 16px;
            border-radius: var(--radius-lg);
            transition: all var(--transition-base);
            cursor: pointer;
            text-decoration: none;
        }
        
        .user-profile:hover {
            background: rgba(45, 143, 187, 0.08);
        }
        
        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 2px solid var(--accent-blue);
            padding: 2px;
            background: var(--pure-white);
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: calc(var(--radius-md) - 2px);
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            color: var(--charcoal);
            font-size: 0.95rem;
        }
        
        .user-role {
            font-size: 0.8rem;
            color: var(--secondary-blue);
            font-weight: 500;
        }
        
        /* ====== SIDEBAR M√âDICALE FLUIDE ====== */
        .medical-sidebar {
            position: fixed;
            left: 0;
            top: 70px;
            bottom: 0;
            width: 280px;
            background: var(--pure-white);
            border-right: 1px solid var(--ice-gray);
            padding: 32px 0;
            overflow-y: auto;
            z-index: 999;
            box-shadow: var(--shadow-sm);
            transition: transform var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar-section {
            padding: 0 24px;
            margin-bottom: 32px;
        }
        
        .sidebar-title {
            font-size: 0.75rem;
            color: var(--slate-gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 16px;
            padding-left: 12px;
        }
        
        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 20px;
            text-decoration: none;
            color: var(--slate-gray);
            border-radius: var(--radius-md);
            transition: all var(--transition-base);
            position: relative;
        }
        
        .sidebar-link:hover {
            background: rgba(45, 143, 187, 0.08);
            color: var(--primary-blue);
            transform: translateX(6px);
        }
        
        .sidebar-link.active {
            background: rgba(45, 143, 187, 0.12);
            color: var(--primary-blue);
            font-weight: 500;
        }
        
        .sidebar-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 60%;
            background: var(--secondary-blue);
            border-radius: 0 var(--radius-full) var(--radius-full) 0;
        }
        
        .nav-icon {
            width: 22px;
            text-align: center;
            font-size: 1.1rem;
            transition: transform var(--transition-fast);
        }
        
        .sidebar-link:hover .nav-icon {
            transform: scale(1.1);
        }
        
        .nav-badge {
            margin-left: auto;
            background: var(--gradient-primary);
            color: var(--pure-white);
            font-size: 0.7rem;
            padding: 4px 10px;
            border-radius: var(--radius-full);
            font-weight: 600;
            min-width: 24px;
            text-align: center;
        }
        
        /* ====== CONTENU PRINCIPAL ====== */
        .dashboard-content {
            margin-left: 280px;
            margin-top: 70px;
            padding: 40px;
            min-height: calc(100vh - 70px);
            background: linear-gradient(135deg, var(--snow-white) 0%, var(--light-blue) 100%);
        }
        
        /* En-t√™te de Section */
        .page-header {
            margin-bottom: 40px;
        }
        
        .page-header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            background: var(--gradient-analytics);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            line-height: 1.2;
        }
        
        .page-subtitle {
            color: var(--slate-gray);
            font-size: 1.2rem;
            max-width: 800px;
            line-height: 1.6;
        }
        
        /* Filtres Analytiques */
        .analytics-filters {
            background: var(--pure-white);
            border-radius: var(--radius-lg);
            padding: 28px;
            box-shadow: var(--shadow-md);
            margin-bottom: 40px;
            border: 1px solid var(--ice-gray);
        }
        
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .filter-header h3 {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--charcoal);
            margin: 0;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--slate-gray);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .filter-select {
            padding: 12px 16px;
            border: 1px solid var(--ice-gray);
            border-radius: var(--radius-md);
            background: var(--pure-white);
            color: var(--charcoal);
            font-size: 0.95rem;
            transition: all var(--transition-base);
            width: 100%;
            cursor: pointer;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(87, 193, 235, 0.1);
        }
        
        .date-range {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .date-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--ice-gray);
            border-radius: var(--radius-md);
            background: var(--pure-white);
            color: var(--charcoal);
            font-size: 0.95rem;
            cursor: pointer;
        }
        
        /* Blood Type Filter Styles */
        .blood-type-filter {
            position: relative;
            width: 100%;
        }
        
        .selected-types {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            min-height: 44px;
            padding: 10px 40px 10px 12px;
            border: 1px solid var(--ice-gray);
            border-radius: var(--radius-md);
            background: var(--pure-white);
            cursor: pointer;
            transition: all var(--transition-base);
        }
        
        .selected-types:hover {
            border-color: var(--accent-blue);
        }
        
        .selected-type {
            background: var(--secondary-blue);
            color: var(--pure-white);
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .selected-type .remove-type {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 0.7rem;
            padding: 0;
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .selected-type .remove-type:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .blood-type-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--slate-gray);
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .blood-type-btn:hover {
            background: var(--crystal-gray);
            color: var(--secondary-blue);
        }
        
        .blood-type-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--pure-white);
            border: 1px solid var(--ice-gray);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            display: none;
            margin-top: 4px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .blood-type-dropdown.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .blood-type-options {
            padding: 12px;
        }
        
        .blood-type-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .blood-type-option:hover {
            background: var(--crystal-gray);
        }
        
        .blood-type-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .blood-type-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--pure-white);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .blood-type-badge.o-plus { background: linear-gradient(135deg, #e63946 0%, #ff6b6b 100%); }
        .blood-type-badge.o-minus { background: linear-gradient(135deg, #c1121f 0%, #780000 100%); }
        .blood-type-badge.a-plus { background: linear-gradient(135deg, #2d8fbb 0%, #1a759f 100%); }
        .blood-type-badge.a-minus { background: linear-gradient(135deg, #1a759f 0%, #184e77 100%); }
        .blood-type-badge.b-plus { background: linear-gradient(135deg, #2a9d8f 0%, #1d3557 100%); }
        .blood-type-badge.b-minus { background: linear-gradient(135deg, #2a9d8f 0%, #1d3557 100%); }
        .blood-type-badge.ab-plus { background: linear-gradient(135deg, #9d4edd 0%, #5a189a 100%); }
        .blood-type-badge.ab-minus { background: linear-gradient(135deg, #9d4edd 0%, #5a189a 100%); }
        
        .dropdown-actions {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-top: 1px solid var(--ice-gray);
            background: var(--snow-white);
        }
        
        .btn-small {
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--ice-gray);
            background: var(--pure-white);
            color: var(--slate-gray);
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .btn-small:hover {
            background: var(--crystal-gray);
            color: var(--secondary-blue);
            border-color: var(--accent-blue);
        }
        
        /* Cartes de M√©triques */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }
        
        .metric-card {
            background: var(--pure-white);
            border-radius: var(--radius-lg);
            padding: 28px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--ice-gray);
            transition: all var(--transition-base);
        }
        
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-blue);
        }
        
        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .metric-icon {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            color: var(--pure-white);
            background: var(--gradient-analytics);
        }
        
        .metric-trend {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: var(--radius-full);
            background: rgba(45, 143, 187, 0.1);
            color: var(--secondary-blue);
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .trend-up {
            background: rgba(42, 157, 143, 0.1);
            color: var(--success-green);
        }
        
        .trend-down {
            background: rgba(230, 57, 70, 0.1);
            color: var(--emergency-red);
        }
        
        .metric-value {
            font-size: 2.4rem;
            font-weight: 700;
            color: var(--charcoal);
            line-height: 1;
            margin-bottom: 8px;
        }
        
        .metric-label {
            font-size: 1rem;
            color: var(--slate-gray);
            margin-bottom: 20px;
        }
        
        .metric-chart-mini {
            height: 80px;
            margin-top: 16px;
        }
        
        /* Grille des Graphiques */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 28px;
            margin-bottom: 40px;
        }
        
        .chart-card {
            background: var(--pure-white);
            border-radius: var(--radius-lg);
            padding: 28px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--ice-gray);
            transition: all var(--transition-base);
        }
        
        .chart-card:hover {
            box-shadow: var(--shadow-lg);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .chart-header h4 {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--charcoal);
            margin: 0;
        }
        
        .chart-actions {
            display: flex;
            gap: 8px;
        }
        
        .chart-btn {
            padding: 8px 16px;
            border-radius: var(--radius-md);
            border: 1px solid var(--ice-gray);
            background: var(--pure-white);
            color: var(--slate-gray);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .chart-btn:hover {
            background: var(--crystal-gray);
            color: var(--secondary-blue);
            border-color: var(--accent-blue);
        }
        
        .chart-container {
            height: 320px;
            position: relative;
        }
        
        /* Tableau Analytique */
        .analytics-table {
            background: var(--pure-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--ice-gray);
            overflow: hidden;
            margin-bottom: 40px;
        }
        
        .table-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--ice-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--snow-white);
        }
        
        .table-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--charcoal);
            margin: 0;
        }
        
        .table-content {
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            margin: 0;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .table th {
            background: var(--light-blue);
            padding: 18px 24px;
            font-weight: 600;
            color: var(--secondary-blue);
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--ice-gray);
            text-align: left;
        }
        
        .table td {
            padding: 20px 24px;
            border-bottom: 1px solid var(--ice-gray);
            vertical-align: middle;
            color: var(--charcoal);
        }
        
        .table tbody tr:hover {
            background: rgba(45, 143, 187, 0.05);
        }
        
        /* Pr√©dictions IA */
        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 28px;
            margin-bottom: 40px;
        }
        
        .prediction-card {
            background: linear-gradient(135deg, rgba(114, 9, 183, 0.05) 0%, rgba(157, 78, 221, 0.05) 100%);
            border: 1px solid rgba(157, 78, 221, 0.2);
            border-radius: var(--radius-lg);
            padding: 32px;
            position: relative;
            overflow: hidden;
        }
        
        .prediction-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-analytics);
        }
        
        .ai-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            background: var(--gradient-analytics);
            color: var(--pure-white);
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .prediction-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 16px;
        }
        
        .prediction-content {
            margin-bottom: 24px;
        }
        
        .prediction-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--data-science);
            margin-bottom: 12px;
        }
        
        .confidence-level {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 20px;
        }
        
        .confidence-bar {
            flex: 1;
            height: 8px;
            background: var(--ice-gray);
            border-radius: var(--radius-full);
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: var(--gradient-analytics);
            border-radius: var(--radius-full);
            transition: width 1s ease;
        }
        
        .confidence-value {
            font-size: 0.9rem;
            color: var(--slate-gray);
            font-weight: 600;
        }
        
        /* KPI Dashboard */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .kpi-card {
            background: var(--pure-white);
            border-radius: var(--radius-md);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--ice-gray);
            text-align: center;
            transition: all var(--transition-base);
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--charcoal);
            line-height: 1;
            margin-bottom: 8px;
        }
        
        .kpi-label {
            font-size: 0.9rem;
            color: var(--slate-gray);
            font-weight: 500;
        }
        
        .kpi-change {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: var(--radius-full);
            margin-top: 8px;
            display: inline-block;
        }
        
        .kpi-change.positive {
            background: rgba(42, 157, 143, 0.1);
            color: var(--success-green);
        }
        
        .kpi-change.negative {
            background: rgba(230, 57, 70, 0.1);
            color: var(--emergency-red);
        }
        
        /* Export et Partage */
        .export-panel {
            background: var(--pure-white);
            border-radius: var(--radius-lg);
            padding: 28px;
            box-shadow: var(--shadow-md);
            margin-bottom: 40px;
            border: 1px solid var(--ice-gray);
        }
        
        .export-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .export-header h3 {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--charcoal);
            margin: 0;
        }
        
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .export-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 20px;
            border: 2px solid var(--ice-gray);
            border-radius: var(--radius-md);
            background: var(--pure-white);
            color: var(--charcoal);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
        }
        
        .export-btn:hover {
            border-color: var(--secondary-blue);
            background: rgba(45, 143, 187, 0.05);
            transform: translateY(-2px);
        }
        
        .export-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: var(--pure-white);
        }
        
        .export-icon.pdf {
            background: linear-gradient(135deg, #e63946 0%, #ff6b6b 100%);
        }
        
        .export-icon.excel {
            background: linear-gradient(135deg, #2a9d8f 0%, #4cc9f0 100%);
        }
        
        .export-icon.chart {
            background: var(--gradient-analytics);
        }
        
        .export-icon.api {
            background: linear-gradient(135deg, #f4a261 0%, #e76f51 100%);
        }
        
        /* Footer M√©dical */
        .medical-footer {
            background: var(--pure-white);
            border-top: 1px solid var(--ice-gray);
            padding: 28px 40px;
            margin-top: 40px;
            margin-left: -40px;
            margin-right: -40px;
            margin-bottom: -40px;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .footer-links {
            display: flex;
            gap: 28px;
        }
        
        .footer-link {
            color: var(--slate-gray);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color var(--transition-fast);
        }
        
        .footer-link:hover {
            color: var(--secondary-blue);
        }
        
        .footer-copyright {
            color: var(--slate-gray);
            font-size: 0.9rem;
        }
        
        /* ====== RESPONSIVE DESIGN ====== */
        @media (max-width: 1200px) {
            .medical-sidebar {
                width: 240px;
            }
            
            .dashboard-content {
                margin-left: 240px;
                padding: 32px;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 992px) {
            .medical-sidebar {
                transform: translateX(-100%);
            }
            
            .medical-sidebar.active {
                transform: translateX(0);
            }
            
            .dashboard-content {
                margin-left: 0;
            }
            
            .main-nav {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .search-input {
                width: 200px;
            }
            
            .search-input:focus {
                width: 240px;
            }
            
            .predictions-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-content {
                padding: 24px;
            }
            
            .page-header h1 {
                font-size: 2.2rem;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .export-options {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .footer-links {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-content {
                padding: 20px;
            }
            
            .page-header h1 {
                font-size: 1.8rem;
            }
            
            .metric-card, .chart-card {
                padding: 24px;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* ====== BOUTON MENU MOBILE ====== */
        .mobile-menu-btn {
            display: none;
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            border: 1px solid var(--ice-gray);
            background: var(--pure-white);
            color: var(--slate-gray);
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-base);
            margin-right: 12px;
        }
        
        .mobile-menu-btn:hover {
            background: var(--crystal-gray);
            border-color: var(--accent-blue);
            color: var(--secondary-blue);
        }
        
        /* ====== OVERLAY MOBILE ====== */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 998;
        }
        
        .sidebar-overlay.active {
            display: block;
        }
        
        /* ====== ANIMATIONS ====== */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s var(--transition-base);
        }
        
        /* ====== SCROLLBAR PERSONNALIS√âE ====== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--crystal-gray);
            border-radius: var(--radius-full);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--secondary-blue);
            border-radius: var(--radius-full);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-blue);
        }
    </style>
</head>
<body>
    <!-- Header Hospitalier -->
    <header class="hospital-header">
        <div class="header-container">
            <!-- Logo et Menu Mobile -->
            <div style="display: flex; align-items: center; gap: 16px;">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                
                <a href="index.html" class="medical-logo">
                    <div class="logo-icon">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <div class="logo-text">
                        <h1>BloodLink</h1>
                        <span>Syst√®me de don de sang</span>
                    </div>
                </a>
            </div>
            
            <!-- Navigation Principale -->
            <nav class="main-nav">
                <a href="index.html" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    Tableau de bord
                </a>
                <a href="alertes" class="nav-item">
                    <i class="fas fa-chart-network"></i>
                    Alertes
                </a>
                <a href="#donors" class="nav-item">
                    <i class="fas fa-user-injured"></i>
                    Donneurs
                </a>
                <a href="#inventory" class="nav-item">
                    <i class="fas fa-tint"></i>
                    Stocks
                </a>
                <a href="#appointments" class="nav-item">
                    <i class="fas fa-calendar-check"></i>
                    Rendez-vous
                </a>
            </nav>
            
            <!-- Actions Droite -->
            <div class="header-actions">
                <!-- Recherche -->
                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Rechercher analyses, indicateurs..." id="searchInput">
                </div>
                
                <!-- Notifications -->
                <div class="notification-wrapper">
                    <button class="notification-btn" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationCount">5</span>
                    </button>
                </div>
                
                <!-- Profil Utilisateur -->
                <a href="#profile" class="user-profile">
                    <div class="user-avatar">
                        <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face" alt="Dr. Martin">
                    </div>
                    <div class="user-info">
                        <div class="user-name">Dr. Sow</div>
                        <div class="user-role">Data Scientist</div>
                    </div>
                </a>
            </div>
        </div>
    </header>
    
    <!-- Overlay Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Sidebar M√©dicale -->
    <aside class="medical-sidebar" id="medicalSidebar">
        <div class="sidebar-section">
            <div class="sidebar-title">Tableau de bord</div>
            <nav class="sidebar-nav">
                <a href="index.html" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-chart-pie"></i></div>
                    Vue d'ensemble
                </a>
                <a href="analytiques.html" class="sidebar-link active">
                    <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
                    Analytiques
                </a>
                <a href="rapports.html" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-file-medical"></i></div>
                    Rapports
                </a>
            </nav>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-title">Gestion des Dons</div>
            <nav class="sidebar-nav">
                <a href="donsEnCours.html" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-heartbeat"></i></div>
                    Dons en cours
                    <span class="nav-badge" id="donationsCount">8</span>
                </a>
                <a href="historique.html" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-history"></i></div>
                    Historique
                </a>
                <a href="#appointments" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-calendar-alt"></i></div>
                    Rendez-vous
                    <span class="nav-badge" id="appointmentsCount">12</span>
                </a>
            </nav>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-title">Gestion des Stocks</div>
            <nav class="sidebar-nav">
                <a href="#inventory" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-boxes"></i></div>
                    Inventaire
                </a>
                <a href="#requests" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-exchange-alt"></i></div>
                    Demandes
                    <span class="nav-badge emergency-badge" id="requestsCount">3</span>
                </a>
                <a href="#distribution" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-truck-medical"></i></div>
                    Distribution
                </a>
            </nav>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-title">Patients & Soins</div>
            <nav class="sidebar-nav">
                <a href="#patients" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-procedures"></i></div>
                    Patients
                </a>
                <a href="#transfusions" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-syringe"></i></div>
                    Transfusions
                    <span class="nav-badge" id="transfusionsCount">5</span>
                </a>
                <a href="#emergency" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-ambulance"></i></div>
                    Urgences
                </a>
            </nav>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-title">Communication</div>
            <nav class="sidebar-nav">
                <a href="#alerts" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-bullhorn"></i></div>
                    Alertes syst√®me
                </a>
                <a href="#messages" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-comments"></i></div>
                    Messages
                    <span class="nav-badge" id="messagesCount">4</span>
                </a>
                <a href="#notifications" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-bell"></i></div>
                    Notifications
                </a>
            </nav>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-title">Administration</div>
            <nav class="sidebar-nav">
                <a href="#staff" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-user-md"></i></div>
                    Personnel
                </a>
                <a href="#settings" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-cogs"></i></div>
                    Param√®tres
                </a>
                <a href="#help" class="sidebar-link">
                    <div class="nav-icon"><i class="fas fa-question-circle"></i></div>
                    Aide & Support
                </a>
            </nav>
        </div>
    </aside>
    
    <!-- Contenu Principal -->
    <main class="dashboard-content">
        <!-- En-t√™te -->
        <div class="page-header">
            <h1 id="pageTitle">Analytiques Avanc√©es</h1>
            <p class="page-subtitle" id="pageSubtitle">Tableau de bord d'analyse pr√©dictive et de visualisation de donn√©es pour optimiser la gestion des dons de sang au S√©n√©gal.</p>
        </div>
        
        <!-- Filtres -->
        <div class="analytics-filters fade-in-up">
            <div class="filter-header">
                <h3>üéØ Filtres d'analyse</h3>
                <button class="chart-btn" onclick="applyFilters()">
                    <i class="fas fa-play"></i>
                    Appliquer
                </button>
            </div>
            <div class="filter-grid">
                <div class="filter-group">
                    <label class="filter-label">
                        <i class="fas fa-calendar"></i>
                        P√©riode
                    </label>
                    <div class="date-range">
                        <input type="date" class="date-input" id="dateStart" value="2024-01-01">
                        <span>au</span>
                        <input type="date" class="date-input" id="dateEnd" value="2024-03-31">
                    </div>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">
                        <i class="fas fa-tint"></i>
                        Type sanguin
                    </label>
                    <div class="blood-type-filter">
                        <div class="selected-types" id="selectedTypes" onclick="toggleBloodTypeDropdown()">
                            <!-- Les types s√©lectionn√©s appara√Ætront ici -->
                        </div>
                        <button type="button" class="blood-type-btn" onclick="toggleBloodTypeDropdown()">
                            <i class="fas fa-chevron-down" id="dropdownIcon"></i>
                        </button>
                        <div class="blood-type-dropdown" id="bloodTypeDropdown">
                            <div class="blood-type-options" id="bloodTypeOptions">
                                <!-- Les options seront g√©n√©r√©es dynamiquement -->
                            </div>
                            <div class="dropdown-actions">
                                <button type="button" class="btn-small" onclick="selectAllBloodTypes()">Tout s√©lectionner</button>
                                <button type="button" class="btn-small" onclick="clearAllBloodTypes()">Tout effacer</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">
                        <i class="fas fa-hospital"></i>
                        H√¥pital
                    </label>
                    <select class="filter-select" id="hospitalSelect">
                        <option value="all">Tous les h√¥pitaux</option>
                        <!-- Les options seront g√©n√©r√©es dynamiquement -->
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">
                        <i class="fas fa-chart-bar"></i>
                        Granularit√©
                    </label>
                    <select class="filter-select" id="granularitySelect">
                        <option value="daily">Quotidienne</option>
                        <option value="weekly" selected>Hebdomadaire</option>
                        <option value="monthly">Mensuelle</option>
                        <option value="quarterly">Trimestrielle</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- KPI Dashboard -->
        <div class="kpi-grid fade-in-up" id="kpiGrid">
            <!-- Les KPI seront g√©n√©r√©s dynamiquement -->
        </div>
        
        <!-- M√©triques principales -->
        <div class="metrics-grid fade-in-up" id="metricsGrid">
            <!-- Les m√©triques seront g√©n√©r√©es dynamiquement -->
        </div>
        
        <!-- Graphiques principaux -->
        <div class="charts-grid" id="chartsGrid">
            <!-- Les graphiques seront g√©n√©r√©s dynamiquement -->
        </div>
        
        <!-- Pr√©dictions IA -->
        <div class="predictions-grid fade-in-up" id="predictionsGrid">
            <!-- Les pr√©dictions seront g√©n√©r√©es dynamiquement -->
        </div>
        
        <!-- Tableau analytique -->
        <div class="analytics-table fade-in-up">
            <div class="table-header">
                <h3>üìä Donn√©es d√©taill√©es par h√¥pital</h3>
                <div class="chart-actions">
                    <button class="chart-btn" onclick="exportTableData()">
                        <i class="fas fa-file-export"></i>
                        Exporter
                    </button>
                </div>
            </div>
            <div class="table-content">
                <table class="table" id="hospitalTable">
                    <thead>
                        <tr>
                            <th>H√¥pital</th>
                            <th>Dons</th>
                            <th>Nouveaux</th>
                            <th>Taux retour</th>
                            <th>Stock (jours)</th>
                            <th>Satisfaction</th>
                            <th>Tendance</th>
                        </tr>
                    </thead>
                    <tbody id="hospitalTableBody">
                        <!-- Les donn√©es seront g√©n√©r√©es dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Options d'export -->
        <div class="export-panel fade-in-up">
            <div class="export-header">
                <h3>üì§ Exporter les donn√©es</h3>
                <button class="chart-btn" onclick="exportAll()">
                    <i class="fas fa-file-export"></i>
                    Tout exporter
                </button>
            </div>
            <div class="export-options">
                <button class="export-btn" onclick="exportPDF()">
                    <div class="export-icon pdf">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px;">Rapport PDF</div>
                        <div style="font-size: 0.9rem; color: var(--slate-gray);">Rapport complet avec graphiques</div>
                    </div>
                </button>
                
                <button class="export-btn" onclick="exportExcel()">
                    <div class="export-icon excel">
                        <i class="fas fa-file-excel"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px;">Donn√©es Excel</div>
                        <div style="font-size: 0.9rem; color: var(--slate-gray);">Donn√©es brutes pour analyse</div>
                    </div>
                </button>
                
                <button class="export-btn" onclick="exportCharts()">
                    <div class="export-icon chart">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px;">Graphiques</div>
                        <div style="font-size: 0.9rem; color: var(--slate-gray);">Images haute r√©solution</div>
                    </div>
                </button>
                
                <button class="export-btn" onclick="exportAPI()">
                    <div class="export-icon api">
                        <i class="fas fa-code"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px;">API JSON</div>
                        <div style="font-size: 0.9rem; color: var(--slate-gray);">Format structur√© pour API</div>
                    </div>
                </button>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="medical-footer">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="#privacy" class="footer-link">Confidentialit√©</a>
                    <a href="#terms" class="footer-link">Conditions</a>
                    <a href="#api-docs" class="footer-link">API Docs</a>
                    <a href="#help" class="footer-link">Support</a>
                </div>
                <div class="footer-copyright" id="footerCopyright">
                    ¬© 2024 BloodLink Analytics v3.1.2 ‚Ä¢ Minist√®re de la Sant√© du S√©n√©gal
                </div>
            </div>
        </footer>
    </main>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    
    <script>
        // ====== DONN√âES DYNAMIQUES ======
        const bloodTypes = ['O+', 'O-', 'A+', 'A-', 'B+', 'B-', 'AB+', 'AB-'];
        const hospitals = [
            { id: 'fann', name: 'CHU Fann', city: 'Dakar', code: 'F' },
            { id: 'le-dantec', name: 'H√¥pital Le Dantec', city: 'Dakar', code: 'L' },
            { id: 'principal', name: 'H√¥pital Principal', city: 'Dakar', code: 'P' },
            { id: 'abass', name: 'H√¥pital Abass Ndao', city: 'Dakar', code: 'A' },
            { id: 'dalal-jamm', name: 'H√¥pital Dalal Jamm', city: 'Gu√©diawaye', code: 'D' }
        ];
        
        let selectedBloodTypes = ['O+', 'A+'];
        let currentFilters = {
            startDate: '2024-01-01',
            endDate: '2024-03-31',
            hospital: 'all',
            granularity: 'weekly'
        };
        
        // ====== INITIALISATION ======
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser AOS
            AOS.init({
                duration: 800,
                once: true,
                offset: 100,
                easing: 'ease-out-cubic'
            });
            
            // Gestion du menu mobile
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const medicalSidebar = document.getElementById('medicalSidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            
            mobileMenuBtn.addEventListener('click', function() {
                medicalSidebar.classList.toggle('active');
                sidebarOverlay.classList.toggle('active');
                document.body.style.overflow = medicalSidebar.classList.contains('active') ? 'hidden' : '';
            });
            
            sidebarOverlay.addEventListener('click', function() {
                medicalSidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
                document.body.style.overflow = '';
            });
            
            // Initialiser toutes les donn√©es dynamiques
            initializeDynamicData();
            
            // Gestion des notifications
            setupNotifications();
            
            // Animation des cartes
            animateCards();
            
            // Recherche en temps r√©el
            setupSearch();
            
            // Mettre √† jour la date du footer
            updateFooterDate();
        });
        
        // ====== DONN√âES DYNAMIQUES ======
        function initializeDynamicData() {
            // Initialiser le filtre des types sanguins
            initializeBloodTypeFilter();
            
            // Initialiser les h√¥pitaux dans le select
            initializeHospitalSelect();
            
            // G√©n√©rer les donn√©es KPI
            generateKPIData();
            
            // G√©n√©rer les m√©triques principales
            generateMetricsData();
            
            // G√©n√©rer les graphiques
            initializeCharts();
            
            // G√©n√©rer les pr√©dictions IA
            generatePredictions();
            
            // G√©n√©rer le tableau des h√¥pitaux
            generateHospitalTable();
            
            // Mettre √† jour les badges de la sidebar
            updateSidebarBadges();
        }
        
        // ====== FILTRE DES TYPES SANGUINS ======
        function initializeBloodTypeFilter() {
            const container = document.getElementById('bloodTypeOptions');
            container.innerHTML = '';
            
            bloodTypes.forEach(type => {
                const isSelected = selectedBloodTypes.includes(type);
                const option = document.createElement('label');
                option.className = 'blood-type-option';
                option.innerHTML = `
                    <input type="checkbox" value="${type}" ${isSelected ? 'checked' : ''} onchange="updateBloodTypeSelection('${type}', this.checked)">
                    <span class="blood-type-badge ${type.toLowerCase().replace('+', '-plus').replace('-', '-minus')}">${type}</span>
                    <span>${getBloodTypeLabel(type)}</span>
                `;
                container.appendChild(option);
            });
            
            updateSelectedTypesDisplay();
        }
        
        function getBloodTypeLabel(type) {
            const labels = {
                'O+': 'O Positif',
                'O-': 'O N√©gatif',
                'A+': 'A Positif',
                'A-': 'A N√©gatif',
                'B+': 'B Positif',
                'B-': 'B N√©gatif',
                'AB+': 'AB Positif',
                'AB-': 'AB N√©gatif'
            };
            return labels[type] || type;
        }
        
        function updateBloodTypeSelection(type, isSelected) {
            if (isSelected && !selectedBloodTypes.includes(type)) {
                selectedBloodTypes.push(type);
            } else if (!isSelected && selectedBloodTypes.includes(type)) {
                selectedBloodTypes = selectedBloodTypes.filter(t => t !== type);
            }
            updateSelectedTypesDisplay();
        }
        
        function updateSelectedTypesDisplay() {
            const container = document.getElementById('selectedTypes');
            container.innerHTML = '';
            
            if (selectedBloodTypes.length === 0) {
                const placeholder = document.createElement('span');
                placeholder.className = 'placeholder';
                placeholder.textContent = 'S√©lectionnez un type...';
                placeholder.style.color = 'var(--slate-gray)';
                placeholder.style.fontStyle = 'italic';
                container.appendChild(placeholder);
            } else {
                selectedBloodTypes.forEach(type => {
                    const badge = document.createElement('span');
                    badge.className = 'selected-type';
                    badge.innerHTML = `
                        ${type}
                        <button type="button" class="remove-type" onclick="removeBloodType('${type}')">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    container.appendChild(badge);
                });
            }
        }
        
        function toggleBloodTypeDropdown() {
            const dropdown = document.getElementById('bloodTypeDropdown');
            const icon = document.getElementById('dropdownIcon');
            
            dropdown.classList.toggle('show');
            icon.classList.toggle('fa-chevron-down');
            icon.classList.toggle('fa-chevron-up');
            
            if (dropdown.classList.contains('show')) {
                setTimeout(() => {
                    const closeDropdown = (e) => {
                        if (!dropdown.contains(e.target) && 
                            !e.target.closest('.blood-type-btn') && 
                            !e.target.closest('.selected-types')) {
                            dropdown.classList.remove('show');
                            icon.classList.remove('fa-chevron-up');
                            icon.classList.add('fa-chevron-down');
                            document.removeEventListener('click', closeDropdown);
                        }
                    };
                    document.addEventListener('click', closeDropdown);
                }, 100);
            }
        }
        
        function removeBloodType(type) {
            const checkbox = document.querySelector(`.blood-type-option input[value="${type}"]`);
            if (checkbox) {
                checkbox.checked = false;
                updateBloodTypeSelection(type, false);
            }
        }
        
        function selectAllBloodTypes() {
            selectedBloodTypes = [...bloodTypes];
            const checkboxes = document.querySelectorAll('.blood-type-option input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            updateSelectedTypesDisplay();
        }
        
        function clearAllBloodTypes() {
            selectedBloodTypes = [];
            const checkboxes = document.querySelectorAll('.blood-type-option input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateSelectedTypesDisplay();
        }
        
        // ====== H√îPITAUX ======
        function initializeHospitalSelect() {
            const select = document.getElementById('hospitalSelect');
            select.innerHTML = '<option value="all">Tous les h√¥pitaux</option>';
            
            hospitals.forEach(hospital => {
                const option = document.createElement('option');
                option.value = hospital.id;
                option.textContent = `${hospital.name}, ${hospital.city}`;
                select.appendChild(option);
            });
        }
        
        // ====== KPI ======
        function generateKPIData() {
            const kpiData = [
                { value: generateRandomPercentage(92, 96), label: 'Taux de satisfaction', change: generateRandomChange(1, 3, true) },
                { value: generateRandomNumber(25, 32) + 'min', label: 'Temps moyen', change: generateRandomChange(8, 15, false) },
                { value: generateRandomPercentage(85, 90), label: 'Taux de retour', change: generateRandomChange(4, 7, true) },
                { value: generateRandomNumber(12, 14) + '.‚Ç¨', label: 'Co√ªt/unitaire', change: generateRandomChange(0.5, 1.5, false) },
                { value: generateRandomPercentage(98, 99.5), label: 'Pr√©cision', change: generateRandomChange(0.1, 0.5, true) }
            ];
            
            const container = document.getElementById('kpiGrid');
            container.innerHTML = '';
            
            kpiData.forEach(kpi => {
                const card = document.createElement('div');
                card.className = 'kpi-card fade-in-up';
                card.innerHTML = `
                    <div class="kpi-value">${kpi.value}</div>
                    <div class="kpi-label">${kpi.label}</div>
                    <span class="kpi-change ${kpi.change.isPositive ? 'positive' : 'negative'}">
                        <i class="fas fa-arrow-${kpi.change.isPositive ? 'up' : 'up'}"></i> ${kpi.change.value}%
                    </span>
                `;
                container.appendChild(card);
            });
        }
        
        // ====== M√âTRIQUES ======
        function generateMetricsData() {
            const metricsData = [
                { 
                    icon: 'fa-heartbeat',
                    value: generateRandomNumber(2500, 3000),
                    label: 'Dons ce trimestre',
                    trend: generateRandomChange(12, 18, true)
                },
                { 
                    icon: 'fa-users',
                    value: generateRandomNumber(1000, 1300),
                    label: 'Nouveaux donneurs',
                    trend: generateRandomChange(6, 10, true)
                },
                { 
                    icon: 'fa-boxes-stacked',
                    value: generateRandomNumber(3.5, 4.5) + 'j',
                    label: 'Stock moyen (jours)',
                    trend: generateRandomChange(2, 5, false)
                }
            ];
            
            const container = document.getElementById('metricsGrid');
            container.innerHTML = '';
            
            metricsData.forEach((metric, index) => {
                const card = document.createElement('div');
                card.className = 'metric-card fade-in-up';
                card.style.animationDelay = `${index * 0.1}s`;
                card.innerHTML = `
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas ${metric.icon}"></i>
                        </div>
                        <div class="metric-trend ${metric.trend.isPositive ? 'trend-up' : 'trend-down'}">
                            <i class="fas fa-arrow-${metric.trend.isPositive ? 'up' : 'down'}"></i>
                            ${metric.trend.value}%
                        </div>
                    </div>
                    <div class="metric-value">${metric.value.toLocaleString()}</div>
                    <div class="metric-label">${metric.label}</div>
                    <div class="metric-chart-mini">
                        <canvas id="miniChart${index}"></canvas>
                    </div>
                `;
                container.appendChild(card);
                
                // Initialiser le mini graphique
                setTimeout(() => initializeMiniChart(`miniChart${index}`, metric.trend.isPositive), 100);
            });
        }
        
        // ====== GRAPHIQUES ======
        function initializeCharts() {
            // Attendre que le DOM soit pr√™t
            setTimeout(() => {
                // Graphique des tendances
                initializeTrendsChart();
                
                // Graphique de distribution
                initializeDistributionChart();
                
                // Graphique de corr√©lation
                initializeCorrelationChart();
                
                // Graphique temporel
                initializeTimelineChart();
            }, 500);
        }
        
        function initializeTrendsChart() {
            const ctx = document.getElementById('trendsChart');
            if (!ctx) return;
            
            const months = ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Ao√ª', 'Sep', 'Oct', 'Nov', 'D√©c'];
            const datasets = selectedBloodTypes.map((type, index) => {
                const baseData = Array(12).fill(0).map(() => generateRandomNumber(50, 150));
                const sortedData = [...baseData].sort((a, b) => a - b);
                
                return {
                    label: type,
                    data: sortedData,
                    borderColor: getBloodTypeColor(type),
                    backgroundColor: `${getBloodTypeColor(type)}20`,
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                };
            });
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: datasets
                },
                options: getChartOptions('Tendances mensuelles des dons par type sanguin')
            });
        }
        
        function initializeDistributionChart() {
            const ctx = document.getElementById('distributionChart');
            if (!ctx) return;
            
            const hospitalData = hospitals.map(hospital => ({
                name: hospital.name,
                donations: generateRandomNumber(400, 1300)
            }));
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: hospitalData.map(h => h.name.split(' ')[0]),
                    datasets: [{
                        label: 'Dons par h√¥pital',
                        data: hospitalData.map(h => h.donations),
                        backgroundColor: [
                            '#1a5f7a', '#2d8fbb', '#008b8b',
                            '#9d4edd', '#f4a261'
                        ],
                        borderColor: '#ffffff',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: getChartOptions('Distribution des dons par h√¥pital au S√©n√©gal')
            });
        }
        
        function initializeCorrelationChart() {
            const ctx = document.getElementById('correlationChart');
            if (!ctx) return;
            
            const dataPoints = [];
            for (let i = 0; i < 20; i++) {
                const x = generateRandomNumber(10, 50);
                const y = 80 + (x * 0.34) + generateRandomNumber(-5, 5);
                dataPoints.push({ x, y });
            }
            
            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Corr√©lation',
                        data: dataPoints,
                        backgroundColor: '#9d4edd',
                        borderColor: '#7209b7',
                        borderWidth: 2,
                        pointRadius: 8,
                        pointHoverRadius: 12
                    }]
                },
                options: getChartOptions('Corr√©lation entre temps d\'attente et satisfaction')
            });
        }
        
        function initializeTimelineChart() {
            const ctx = document.getElementById('timelineChart');
            if (!ctx) return;
            
            const weeks = ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4', 'Sem 5', 'Sem 6', 'Sem 7', 'Sem 8'];
            const donations = weeks.map(() => generateRandomNumber(280, 400));
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeks,
                    datasets: [
                        {
                            label: 'Dons',
                            data: donations,
                            borderColor: '#1a5f7a',
                            backgroundColor: 'rgba(26, 95, 122, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Objectif',
                            data: weeks.map(() => 350),
                            borderColor: '#e63946',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false
                        }
                    ]
                },
                options: getChartOptions('√âvolution hebdomadaire vs Objectif')
            });
        }
        
        function initializeMiniChart(canvasId, isPositive) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            const data = Array(12).fill(0).map(() => generateRandomNumber(40, 100));
            if (!isPositive) {
                data.reverse();
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(12).fill(''),
                    datasets: [{
                        data: data,
                        borderColor: isPositive ? '#2a9d8f' : '#e63946',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
        }
        
        // ====== PR√âDICTIONS IA ======
        function generatePredictions() {
            const predictions = [
                {
                    title: 'Pr√©vision de la demande',
                    value: `+${generateRandomNumber(15, 22)}%`,
                    description: 'Augmentation pr√©vue de la demande en O- pour les 15 prochains jours',
                    confidence: generateRandomNumber(85, 95)
                },
                {
                    title: 'Optimisation des stocks',
                    value: `-${generateRandomNumber(12, 18)}%`,
                    description: 'R√©duction possible des pertes par optimisation des niveaux de stock',
                    confidence: generateRandomNumber(80, 90)
                }
            ];
            
            const container = document.getElementById('predictionsGrid');
            container.innerHTML = '';
            
            predictions.forEach((prediction, index) => {
                const card = document.createElement('div');
                card.className = 'prediction-card fade-in-up';
                card.style.animationDelay = `${index * 0.1}s`;
                card.innerHTML = `
                    <div class="ai-badge">
                        <i class="fas fa-robot"></i>
                        IA
                    </div>
                    <h3 class="prediction-title">${prediction.title}</h3>
                    <div class="prediction-content">
                        <div class="prediction-value">${prediction.value}</div>
                        <p>${prediction.description}</p>
                    </div>
                    <div class="confidence-level">
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${prediction.confidence}%"></div>
                        </div>
                        <div class="confidence-value">${prediction.confidence}% de confiance</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // ====== TABLEAU DES H√îPITAUX ======
        function generateHospitalTable() {
            const tbody = document.getElementById('hospitalTableBody');
            tbody.innerHTML = '';
            
            hospitals.forEach(hospital => {
                const donations = generateRandomNumber(400, 1300);
                const newDonors = Math.floor(donations * generateRandomNumber(0.2, 0.3));
                const returnRate = generateRandomNumber(80, 97);
                const stockDays = generateRandomNumber(3, 6);
                const satisfaction = generateRandomNumber(88, 98);
                const trend = generateRandomChange(1, 5, Math.random() > 0.3);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 36px; height: 36px; border-radius: 50%; background: var(--primary-blue); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                                ${hospital.code}
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--charcoal);">${hospital.name}</div>
                                <div style="font-size: 0.85rem; color: var(--slate-gray);">${hospital.city} ‚Ä¢ ID: SEN-${hospital.code}</div>
                            </div>
                        </div>
                    </td>
                    <td>${donations.toLocaleString()}</td>
                    <td>${newDonors.toLocaleString()}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span>${returnRate}%</span>
                            <div style="width: 60px; height: 6px; background: var(--ice-gray); border-radius: 3px;">
                                <div style="width: ${returnRate}%; height: 100%; background: ${getRateColor(returnRate)}; border-radius: 3px;"></div>
                            </div>
                        </div>
                    </td>
                    <td>${stockDays.toFixed(1)}</td>
                    <td>${satisfaction.toFixed(1)}%</td>
                    <td>
                        <div style="color: ${trend.isPositive ? 'var(--success-green)' : 'var(--emergency-red)'}; font-weight: 600;">
                            <i class="fas fa-arrow-${trend.isPositive ? 'up' : 'down'}"></i> ${trend.value}%
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ====== UTILITAIRES ======
        function generateRandomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        function generateRandomPercentage(min, max) {
            return (Math.random() * (max - min) + min).toFixed(1) + '%';
        }
        
        function generateRandomChange(min, max, isPositive) {
            const value = (Math.random() * (max - min) + min).toFixed(1);
            return {
                value: value,
                isPositive: isPositive !== undefined ? isPositive : Math.random() > 0.5
            };
        }
        
        function getBloodTypeColor(type) {
            const colors = {
                'O+': '#e63946',
                'O-': '#c1121f',
                'A+': '#2d8fbb',
                'A-': '#1a759f',
                'B+': '#2a9d8f',
                'B-': '#1d3557',
                'AB+': '#9d4edd',
                'AB-': '#5a189a'
            };
            return colors[type] || '#64748b';
        }
        
        function getRateColor(rate) {
            if (rate >= 90) return '#2a9d8f';
            if (rate >= 80) return '#f4a261';
            return '#e63946';
        }
        
        function getChartOptions(title) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            font: {
                                size: 12,
                                weight: '500'
                            },
                            padding: 20,
                            usePointStyle: true
                        }
                    },
                    title: {
                        display: true,
                        text: title,
                        font: {
                            size: 16,
                            weight: '600'
                        },
                        padding: 20,
                        color: '#334155'
                    },
                    tooltip: {
                        backgroundColor: 'rgba(26, 95, 122, 0.95)',
                        titleColor: '#ffffff',
                        bodyColor: '#ffffff',
                        borderColor: '#2d8fbb',
                        borderWidth: 1,
                        cornerRadius: 8,
                        padding: 12
                    }
                },
                scales: {
                    y: {
                        grid: {
                            color: 'rgba(226, 232, 240, 0.5)',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#64748b',
                            font: {
                                size: 12,
                                weight: '500'
                            }
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(226, 232, 240, 0.5)',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#64748b',
                            font: {
                                size: 12,
                                weight: '500'
                            }
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            };
        }
        
        // ====== FILTRES ======
        function applyFilters() {
            // R√©cup√©rer les valeurs des filtres
            currentFilters = {
                startDate: document.getElementById('dateStart').value,
                endDate: document.getElementById('dateEnd').value,
                hospital: document.getElementById('hospitalSelect').value,
                granularity: document.getElementById('granularitySelect').value
            };
            
            showNotification('‚úÖ Filtres appliqu√©s', 'Les donn√©es ont √©t√© mises √† jour avec les nouveaux filtres.');
            
            // Animation de chargement
            const applyBtn = document.querySelector('.chart-btn');
            const originalText = applyBtn.innerHTML;
            applyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            applyBtn.disabled = true;
            
            // Simuler une mise √† jour des donn√©es
            setTimeout(() => {
                applyBtn.innerHTML = originalText;
                applyBtn.disabled = false;
                
                // Reg√©n√©rer toutes les donn√©es avec les nouveaux filtres
                generateKPIData();
                generateMetricsData();
                generatePredictions();
                generateHospitalTable();
                
                // Mettre √† jour les graphiques
                updateChartsWithFilters();
            }, 1500);
        }
        
        function updateChartsWithFilters() {
            // Ici, vous pourriez recharger les graphiques avec les nouvelles donn√©es filtr√©es
            // Pour l'instant, on simule juste une mise √† jour
            const charts = ['trendsChart', 'distributionChart', 'correlationChart', 'timelineChart'];
            charts.forEach(chartId => {
                const chart = Chart.getChart(chartId);
                if (chart) {
                    // Animer une l√©g√®re modification pour montrer que les donn√©es ont chang√©
                    chart.data.datasets.forEach(dataset => {
                        if (dataset.data && dataset.data.length > 0) {
                            dataset.data = dataset.data.map(value => 
                                value * (0.95 + Math.random() * 0.1)
                            );
                        }
                    });
                    chart.update();
                }
            });
        }
        
        // ====== SIDEBAR BADGES ======
        function updateSidebarBadges() {
            // Mettre √† jour les badges avec des donn√©es al√©atoires
            const badgeIds = ['donationsCount', 'appointmentsCount', 'requestsCount', 'transfusionsCount', 'messagesCount'];
            badgeIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = generateRandomNumber(1, 15);
                }
            });
        }
        
        // ====== FOOTER ======
        function updateFooterDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            const formattedDate = now.toLocaleDateString('fr-FR', options);
            const footer = document.getElementById('footerCopyright');
            if (footer) {
                footer.textContent = `¬© ${now.getFullYear()} BloodLink Analytics v3.1.2 ‚Ä¢ Derni√®re mise √† jour: ${formattedDate}`;
            }
        }
        
        // ====== RECHERCHE ======
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm.length > 2) {
                    // Simuler une recherche
                    showNotification('üîç Recherche en cours', `Recherche de "${searchTerm}"...`);
                }
            });
        }
        
        // ====== NOTIFICATIONS ======
        function setupNotifications() {
            const notificationBtn = document.getElementById('notificationBtn');
            notificationBtn.addEventListener('click', showNotifications);
            
            // Mettre √† jour le nombre de notifications
            setInterval(() => {
                const badge = document.getElementById('notificationCount');
                if (badge && Math.random() > 0.7) {
                    const newCount = Math.min(10, parseInt(badge.textContent) + 1);
                    badge.textContent = newCount;
                    badge.style.animation = 'none';
                    setTimeout(() => badge.style.animation = 'badgePulse 2s infinite', 10);
                }
            }, 30000);
        }
        
        function showNotifications() {
            const notifications = [
                {
                    title: 'Nouvelle analyse disponible',
                    message: `L'analyse pr√©dictive pour ${selectedBloodTypes[0] || 'O-'} a √©t√© mise √† jour`,
                    time: 'Il y a 10 min',
                    icon: 'fa-chart-line',
                    iconColor: '#2d8fbb'
                },
                {
                    title: 'Tendance d√©tect√©e',
                    message: `Augmentation de ${generateRandomNumber(10, 30)}% des demandes en A-`,
                    time: 'Il y a 45 min',
                    icon: 'fa-exclamation-triangle',
                    iconColor: '#f4a261'
                },
                {
                    title: 'Export termin√©',
                    message: 'Votre rapport PDF est pr√™t √† √™tre t√©l√©charg√©',
                    time: 'Il y a 2h',
                    icon: 'fa-file-pdf',
                    iconColor: '#e63946'
                },
                {
                    title: 'Mise √† jour IA',
                    message: 'Le mod√®le de pr√©diction a √©t√© r√©entra√Æn√©',
                    time: 'Il y a 4h',
                    icon: 'fa-robot',
                    iconColor: '#9d4edd'
                },
                {
                    title: 'Nouveau KPI',
                    message: 'Le taux de satisfaction a atteint un nouveau record',
                    time: 'Il y a 6h',
                    icon: 'fa-trophy',
                    iconColor: '#2a9d8f'
                }
            ];
            
            createNotificationModal(notifications);
        }
        
        function createNotificationModal(notifications) {
            const existingModal = document.querySelector('.notification-modal');
            if (existingModal) existingModal.remove();
            
            const modal = document.createElement('div');
            modal.className = 'notification-modal';
            modal.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                width: 380px;
                max-width: 90vw;
                background: var(--pure-white);
                border-radius: var(--radius-lg);
                box-shadow: var(--shadow-xl);
                z-index: 1001;
                border: 1px solid var(--ice-gray);
                overflow: hidden;
                animation: slideIn 0.3s var(--transition-base);
            `;
            
            modal.innerHTML = `
                <div style="padding: 20px 24px; border-bottom: 1px solid var(--ice-gray); background: var(--snow-white); display: flex; justify-content: space-between; align-items: center;">
                    <h4 style="margin: 0; font-size: 1.1rem; color: var(--charcoal); font-weight: 600;">Notifications Analytics</h4>
                    <button onclick="this.closest('.notification-modal').remove()" style="background: none; border: none; color: var(--slate-gray); cursor: pointer; font-size: 1.2rem; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: var(--radius-md); transition: all var(--transition-fast);">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div style="max-height: 400px; overflow-y: auto;">
                    ${notifications.map(notif => `
                        <div style="padding: 16px 24px; border-bottom: 1px solid var(--ice-gray); cursor: pointer; transition: all var(--transition-fast);" onclick="handleNotificationClick('${notif.title}')">
                            <div style="display: flex; align-items: flex-start; gap: 14px;">
                                <div style="width: 40px; height: 40px; border-radius: var(--radius-md); background: ${notif.iconColor}; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                    <i class="fas ${notif.icon}" style="color: white; font-size: 1rem;"></i>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--charcoal); margin-bottom: 6px;">${notif.title}</div>
                                    <div style="font-size: 0.9rem; color: var(--slate-gray); margin-bottom: 8px; line-height: 1.4;">${notif.message}</div>
                                    <div style="font-size: 0.8rem; color: var(--slate-gray); display: flex; align-items: center; gap: 6px;">
                                        <i class="fas fa-clock"></i>
                                        ${notif.time}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div style="padding: 16px 24px; text-align: center; border-top: 1px solid var(--ice-gray); background: var(--snow-white);">
                    <button class="btn-small" onclick="markAllNotificationsAsRead()" style="width: 100%;">
                        <i class="fas fa-check-double"></i>
                        Tout marquer comme lu
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Fermer en cliquant √† l'ext√©rieur
            setTimeout(() => {
                const closeModal = (e) => {
                    if (!modal.contains(e.target) && e.target !== document.getElementById('notificationBtn')) {
                        modal.remove();
                        document.removeEventListener('click', closeModal);
                    }
                };
                document.addEventListener('click', closeModal);
            }, 100);
        }
        
        function handleNotificationClick(title) {
            showNotification('üìã Notification ouverte', `Vous avez cliqu√© sur: ${title}`);
        }
        
        function markAllNotificationsAsRead() {
            const badge = document.getElementById('notificationCount');
            if (badge) {
                badge.textContent = '0';
                badge.style.display = 'none';
            }
            showNotification('‚úÖ Toutes les notifications', 'Toutes les notifications ont √©t√© marqu√©es comme lues.');
            document.querySelector('.notification-modal')?.remove();
        }
        
        // ====== EXPORT ======
        function exportPDF() {
            showNotification('üìÑ PDF en g√©n√©ration', 'Le rapport PDF est en cours de cr√©ation...');
            setTimeout(() => {
                showNotification('‚úÖ PDF pr√™t', 'Le rapport PDF a √©t√© g√©n√©r√© avec succ√®s');
            }, 2000);
        }
        
        function exportExcel() {
            showNotification('üìä Export Excel', 'Les donn√©es sont en cours d\'exportation...');
            setTimeout(() => {
                showNotification('‚úÖ Export termin√©', 'Fichier Excel t√©l√©charg√© avec succ√®s');
            }, 1500);
        }
        
        function exportCharts() {
            const charts = ['trendsChart', 'distributionChart', 'correlationChart', 'timelineChart'];
            charts.forEach(chartId => {
                const chart = Chart.getChart(chartId);
                if (chart) {
                    const link = document.createElement('a');
                    link.download = `bloodlink-${chartId}-${new Date().toISOString().slice(0,10)}.png`;
                    link.href = chart.toBase64Image();
                    link.click();
                }
            });
            showNotification('üñºÔ∏è Graphiques export√©s', `${charts.length} graphiques export√©s en PNG`);
        }
        
        function exportAPI() {
            const apiData = {
                timestamp: new Date().toISOString(),
                filters: currentFilters,
                selectedBloodTypes: selectedBloodTypes,
                data: {
                    hospitals: hospitals.map(h => ({
                        name: h.name,
                        donations: generateRandomNumber(400, 1300)
                    }))
                }
            };
            
            const jsonData = JSON.stringify(apiData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `bloodlink-data-${new Date().toISOString().slice(0,10)}.json`;
            link.click();
            
            showNotification('üîå API JSON', 'Donn√©es export√©es au format JSON');
        }
        
        function exportTableData() {
            const tableData = [];
            const rows = document.querySelectorAll('#hospitalTableBody tr');
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                tableData.push({
                    hopital: cells[0].textContent.trim(),
                    dons: cells[1].textContent.trim(),
                    nouveaux: cells[2].textContent.trim(),
                    tauxRetour: cells[3].textContent.trim(),
                    stock: cells[4].textContent.trim(),
                    satisfaction: cells[5].textContent.trim(),
                    tendance: cells[6].textContent.trim()
                });
            });
            
            const jsonData = JSON.stringify(tableData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `bloodlink-hopitaux-${new Date().toISOString().slice(0,10)}.json`;
            link.click();
            
            showNotification('üì• Donn√©es export√©es', 'Les donn√©es des h√¥pitaux ont √©t√© export√©es');
        }
        
        function exportAll() {
            showNotification('üöÄ Export complet', 'Lancement de l\'export de toutes les donn√©es...');
            
            setTimeout(() => {
                exportPDF();
                setTimeout(() => {
                    exportExcel();
                    setTimeout(() => {
                        exportCharts();
                        setTimeout(() => {
                            exportAPI();
                            setTimeout(() => {
                                exportTableData();
                                showNotification('üéâ Export termin√©', 'Toutes les donn√©es ont √©t√© export√©es');
                            }, 500);
                        }, 500);
                    }, 500);
                }, 500);
            }, 500);
        }
        
        // ====== ANIMATIONS ======
        function animateCards() {
            const cards = document.querySelectorAll('.fade-in-up');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
            });
        }
        
        // ====== NOTIFICATIONS TOAST ======
        function showNotification(title, message) {
            const existingToast = document.querySelector('.notification-toast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'notification-toast';
            toast.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: var(--pure-white);
                border-radius: var(--radius-lg);
                padding: 16px 20px;
                box-shadow: var(--shadow-xl);
                z-index: 1002;
                border: 1px solid var(--ice-gray);
                border-left: 4px solid var(--secondary-blue);
                min-width: 300px;
                animation: slideInRight 0.3s var(--transition-base);
                display: flex;
                align-items: flex-start;
                gap: 12px;
            `;
            
            toast.innerHTML = `
                <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="fas fa-check" style="color: white; font-size: 1rem;"></i>
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 600; color: var(--charcoal); margin-bottom: 4px;">${title}</div>
                    <div style="font-size: 0.9rem; color: var(--slate-gray);">${message}</div>
                </div>
                <button onclick="this.closest('.notification-toast').remove()" style="background: none; border: none; color: var(--slate-gray); cursor: pointer; font-size: 1rem; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: var(--radius-md);">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.body.appendChild(toast);
            
            // Ajouter le style d'animation
            if (!document.querySelector('#toast-animation')) {
                const style = document.createElement('style');
                style.id = 'toast-animation';
                style.textContent = `
                    @keyframes slideInRight {
                        from {
                            opacity: 0;
                            transform: translateX(100%);
                        }
                        to {
                            opacity: 1;
                            transform: translateX(0);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Supprimer automatiquement apr√®s 5 secondes
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOutRight 0.3s var(--transition-base)';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 5000);
        }
        
        // ====== GESTION DU REDIMENSIONNEMENT ======
        window.addEventListener('resize', function() {
            if (window.innerWidth > 992 && document.querySelector('.medical-sidebar.active')) {
                document.querySelector('.medical-sidebar').classList.remove('active');
                document.querySelector('.sidebar-overlay').classList.remove('active');
                document.body.style.overflow = '';
            }
            
            // Redimensionner les graphiques
            const chartIds = ['trendsChart', 'distributionChart', 'correlationChart', 'timelineChart'];
            chartIds.forEach(id => {
                const chart = Chart.getChart(id);
                if (chart) chart.resize();
            });
        });
        
        // Rafra√Æchissement p√©riodique des donn√©es
        setInterval(() => {
            // Rafra√Æchir un KPI al√©atoire
            const kpiCards = document.querySelectorAll('.kpi-card');
            if (kpiCards.length > 0) {
                const randomIndex = Math.floor(Math.random() * kpiCards.length);
                const card = kpiCards[randomIndex];
                const valueElement = card.querySelector('.kpi-value');
                const changeElement = card.querySelector('.kpi-change');
                
                if (valueElement && changeElement) {
                    // Animer le changement
                    card.style.transform = 'scale(1.05)';
                    setTimeout(() => card.style.transform = 'scale(1)', 300);
                    
                    // Mettre √† jour la valeur
                    const currentValue = parseFloat(valueElement.textContent);
                    const newValue = currentValue * (0.95 + Math.random() * 0.1);
                    valueElement.textContent = typeof currentValue === 'number' ? 
                        newValue.toFixed(1) + '%' : 
                        Math.round(newValue) + 'min';
                }
            }
        }, 30000); // Toutes les 30 secondes
    </script>
</body>
</html>