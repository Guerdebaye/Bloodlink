<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BloodLink H√¥pitaux - Connexion & Inscription</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/hospital.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        .auth-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-wrapper {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            width: 100%;
            max-width: 1200px;
            min-height: 600px;
            display: flex;
        }

        .auth-sidebar {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 40px;
            width: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .auth-sidebar h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .auth-sidebar p {
            font-size: 1.1rem;
            line-height: 1.6;
            opacity: 0.9;
        }

        .auth-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            max-height: 90vh;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .auth-tab {
            padding: 15px 30px;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .auth-tab.active {
            color: #e74c3c;
            border-bottom-color: #e74c3c;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
            background: white;
            color: #333;
        }

        .form-group select {
            cursor: pointer;
        }

        .form-group select option {
            background: white;
            color: #333;
            padding: 10px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .required {
            color: #e74c3c;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        .file-upload {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #e74c3c;
            background: #fff5f5;
        }

        .file-upload input {
            display: none;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #e74c3c;
            color: white;
        }

        .btn-primary:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-outline {
            background: white;
            color: #e74c3c;
            border: 2px solid #e74c3c;
        }

        .btn-outline:hover {
            background: #e74c3c;
            color: white;
        }

        .btn-full {
            width: 100%;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .progress-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .progress-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            position: relative;
        }

        .progress-step.active {
            background: #e74c3c;
        }

        .progress-step.completed {
            background: #27ae60;
        }

        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 2px;
            background: #e0e0e0;
        }

        .progress-step.completed:not(:last-child)::after {
            background: #27ae60;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            color: #27ae60;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        .location-picker {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .location-picker button {
            padding: 10px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .password-strength {
            height: 5px;
            background: #e0e0e0;
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            transition: all 0.3s ease;
            border-radius: 3px;
        }

        .password-strength-bar.weak {
            background: #e74c3c;
            width: 33%;
        }

        .password-strength-bar.medium {
            background: #f39c12;
            width: 66%;
        }

        .password-strength-bar.strong {
            background: #27ae60;
            width: 100%;
        }

        @media (max-width: 768px) {
            .auth-wrapper {
                flex-direction: column;
                max-width: 100%;
            }

            .auth-sidebar {
                width: 100%;
                padding: 30px;
            }

            .auth-content {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-wrapper">
            <div class="auth-sidebar">
                <h1>üè• BloodLink</h1>
                <p>Plateforme de gestion sanguine pour les √©tablissements de sant√©</p>
                <br>
                <p><strong>Rejoignez le r√©seau BloodLink</strong></p>
                <ul style="list-style: none; padding: 0; margin-top: 20px;">
                    <li style="margin-bottom: 10px;">‚úÖ Gestion optimis√©e des stocks sanguins</li>
                    <li style="margin-bottom: 10px;">‚úÖ Notifications d'urgence en temps r√©el</li>
                    <li style="margin-bottom: 10px;">‚úÖ R√©servations simplifi√©es</li>
                    <li style="margin-bottom: 10px;">‚úÖ Tableau de bord complet</li>
                </ul>
            </div>

            <div class="auth-content">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchTab('login')">Connexion</button>
                    <button class="auth-tab" onclick="switchTab('register')">Inscription</button>
                </div>

                <!-- Formulaire de Connexion -->
                <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                    <div class="form-section">
                        <h3>üîê Connexion H√¥pital</h3>
                        
                        <div class="form-group">
                            <label>Email professionnel *</label>
                            <input type="email" id="loginEmail" required placeholder="hopital@demo.com" value="hopital@demo.com">
                            <div class="error-message" id="loginEmailError"></div>
                        </div>

                        <div class="form-group">
                            <label>Mot de passe *</label>
                            <input type="password" id="loginPassword" required placeholder="motdepasse" value="motdepasse">
                            <div class="error-message" id="loginPasswordError"></div>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-item">
                                <input type="checkbox" id="rememberMe">
                                <span>Se souvenir de moi</span>
                            </label>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-full">
                                üè• Se connecter
                            </button>
                        </div>

                        <div style="text-align: center; margin-top: 20px;">
                            <a href="#" onclick="showPasswordReset()" style="color: #e74c3c;">Mot de passe oubli√©?</a>
                        </div>
                    </div>
                </form>

                <!-- Formulaire d'Inscription -->
                <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
                    <div class="progress-indicator">
                        <div class="progress-step active" id="step1">1</div>
                        <div class="progress-step" id="step2">2</div>
                        <div class="progress-step" id="step3">3</div>
                        <div class="progress-step" id="step4">4</div>
                    </div>

                    <!-- √âtape 1: Informations Institutionnelles -->
                    <div class="form-section" id="section1">
                        <h3>üè• Informations Institutionnelles</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nom officiel de l'h√¥pital *</label>
                                <input type="text" id="hospitalName" required placeholder="H√¥pital Principal de Dakar">
                            </div>
                            <div class="form-group">
                                <label>Type d'h√¥pital *</label>
                                <select id="hospitalType" required>
                                    <option value="">S√©lectionnez...</option>
                                    <option value="public">Public</option>
                                    <option value="prive">Priv√©</option>
                                    <option value="clinique">Clinique</option>
                                    <option value="centre_sante">Centre de sant√©</option>
                                    <option value="polyclinique">Polyclinique</option>
                                    <option value="chu">CHU</option>
                                    <option value="cabinet">Cabinet m√©dical</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Num√©ro d'agr√©ment *</label>
                                <input type="text" id="agreementNumber" required placeholder="AGR-2024-001">
                            </div>
                            <div class="form-group">
                                <label>Ann√©e de cr√©ation *</label>
                                <input type="number" id="creationYear" required min="1800" max="2024" placeholder="1960">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Statut juridique *</label>
                            <select id="legalStatus" required>
                                <option value="">S√©lectionnez...</option>
                                <option value="etat">√âtat</option>
                                <option value="prive">Priv√©</option>
                                <option value="association">Association</option>
                                <option value="religieux">Religieux</option>
                                <option value="ong">ONG</option>
                            </select>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" onclick="nextStep(1)">
                                Suivant ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- √âtape 2: Coordonn√©es Administratives -->
                    <div class="form-section" id="section2" style="display: none;">
                        <h3>üìç Coordonn√©es Administratives</h3>
                        
                        <div class="form-group">
                            <label>Adresse compl√®te *</label>
                            <input type="text" id="fullAddress" required placeholder="123 Avenue Cheikh Anta Diop, Dakar">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>R√©gion *</label>
                                <select id="region" required>
                                    <option value="">S√©lectionnez...</option>
                                    <option value="dakar">Dakar</option>
                                    <option value="thies">Thi√®s</option>
                                    <option value="kaolack">Kaolack</option>
                                    <option value="fatick">Fatick</option>
                                    <option value="kaolack">Kaolack</option>
                                    <option value="louga">Louga</option>
                                    <option value="saint-louis">Saint-Louis</option>
                                    <option value="diourbel">Diourbel</option>
                                    <option value="tamba">Tambacounda</option>
                                    <option value="kedougou">K√©dougou</option>
                                    <option value="matam">Matam</option>
                                    <option value="kolda">Kolda</option>
                                    <option value="sedhiou">S√©dhiou</option>
                                    <option value="ziguinchor">Ziguinchor</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Ville *</label>
                                <input type="text" id="city" required placeholder="Dakar">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Code postal</label>
                                <input type="text" id="postalCode" placeholder="10000">
                            </div>
                            <div class="form-group">
                                <label>T√©l√©phone principal *</label>
                                <input type="tel" id="mainPhone" required placeholder="+221 33 123 45 67">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Email officiel *</label>
                                <input type="email" id="officialEmail" required placeholder="contact@hopital.sn">
                            </div>
                            <div class="form-group">
                                <label>Site web (optionnel)</label>
                                <input type="url" id="website" placeholder="https://www.hopital.sn">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>G√©olocalisation</label>
                            <div class="location-picker">
                                <input type="text" id="latitude" placeholder="Latitude: 14.6928">
                                <input type="text" id="longitude" placeholder="Longitude: -17.4467">
                                <button type="button" onclick="getLocation()">üìç Localiser sur carte</button>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" onclick="previousStep(2)">
                                ‚Üê Pr√©c√©dent
                            </button>
                            <button type="button" class="btn btn-primary" onclick="nextStep(2)">
                                Suivant ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- √âtape 3: Responsable et Informations Op√©rationnelles -->
                    <div class="form-section" id="section3" style="display: none;">
                        <h3>üë§ Responsable de l'√âtablissement</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nom complet *</label>
                                <input type="text" id="managerName" required placeholder="Dr. Cheikh Ndiaye">
                            </div>
                            <div class="form-group">
                                <label>Fonction *</label>
                                <select id="managerPosition" required>
                                    <option value="">S√©lectionnez...</option>
                                    <option value="directeur">Directeur d'h√¥pital</option>
                                    <option value="medecin_chef">M√©decin-chef</option>
                                    <option value="responsable_admin">Responsable administratif</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>T√©l√©phone professionnel *</label>
                                <input type="tel" id="managerPhone" required placeholder="+221 77 123 45 67">
                            </div>
                            <div class="form-group">
                                <label>Email professionnel *</label>
                                <input type="email" id="managerEmail" required placeholder="c.ndiaye@hopital.sn">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Pi√®ce d'identit√©</label>
                            <div class="file-upload">
                                <input type="file" id="identityFile" accept="image/*,.pdf">
                                <label for="identityFile">
                                    üìÑ Cliquez pour t√©l√©charger la pi√®ce d'identit√©
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Lettre d'autorisation</label>
                            <div class="file-upload">
                                <input type="file" id="authorizationFile" accept=".pdf">
                                <label for="authorizationFile">
                                    üìÑ T√©l√©charger la lettre d'autorisation (PDF)
                                </label>
                            </div>
                        </div>

                        <h3 style="margin-top: 30px;">üìä Informations Op√©rationnelles</h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Capacit√© d'accueil (nombre de lits) *</label>
                                <input type="number" id="bedCapacity" required min="1" placeholder="150">
                            </div>
                        </div>


                        <div class="form-group">
                            <label>Sp√©cialit√©s disponibles *</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="cardio" value="cardiologie">
                                    <label for="cardio">Cardiologie</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="pediatrie" value="pediatrie">
                                    <label for="pediatrie">P√©diatrie</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="urgences" value="urgences">
                                    <label for="urgences">Urgences</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="gyneco" value="gynecologie">
                                    <label for="gyneco">Gyn√©cologie</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="neurologie" value="neurologie">
                                    <label for="neurologie">Neurologie</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orthopedie" value="orthopedie">
                                    <label for="orthopedie">Orthop√©die</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Services disponibles *</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="labo" value="laboratoire">
                                    <label for="labo">Laboratoire</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="imagerie" value="imagerie">
                                    <label for="imagerie">Imagerie</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="pharmacie" value="pharmacie">
                                    <label for="pharmacie">Pharmacie</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="ambulance" value="ambulance">
                                    <label for="ambulance">Ambulance</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="bloc_operatoire" value="bloc_operatoire">
                                    <label for="bloc_operatoire">Bloc op√©ratoire</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" onclick="previousStep(3)">
                                ‚Üê Pr√©c√©dent
                            </button>
                            <button type="button" class="btn btn-primary" onclick="nextStep(3)">
                                Suivant ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- √âtape 4: Compte et Documents -->
                    <div class="form-section" id="section4" style="display: none;">
                        <h3>üîê Identifiants pour la Plateforme</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nom complet administrateur *</label>
                                <input type="text" id="adminName" required placeholder="Dr. Cheikh Ndiaye">
                            </div>
                            <div class="form-group">
                                <label>Email professionnel *</label>
                                <input type="email" id="adminEmail" required placeholder="admin@hopital.sn">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Mot de passe *</label>
                            <input type="password" id="adminPassword" required oninput="checkPasswordStrength()">
                            <div class="password-strength">
                                <div class="password-strength-bar" id="passwordStrengthBar"></div>
                            </div>
                            <small style="color: #666;">8 caract√®res minimum, inclure majuscules, chiffres et symboles</small>
                        </div>

                        <div class="form-group">
                            <label>Confirmation du mot de passe *</label>
                            <input type="password" id="confirmPassword" required>
                            <div class="error-message" id="passwordMatchError"></div>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-item">
                                <input type="checkbox" id="enable2FA">
                                <span>Activer l'authentification √† deux facteurs (recommand√©)</span>
                            </label>
                        </div>

                        <h3 style="margin-top: 30px;">üìã Documents Requis</h3>

                        <div class="form-group">
                            <label>RCCM (Registre de commerce)</label>
                            <div class="file-upload">
                                <input type="file" id="rccmFile" accept=".pdf,image/*">
                                <label for="rccmFile">
                                    üìÑ T√©l√©charger RCCM (PDF ou image)
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>NINEA</label>
                            <div class="file-upload">
                                <input type="file" id="nineaFile" accept=".pdf,image/*">
                                <label for="nineaFile">
                                    üìÑ T√©l√©charger NINEA (PDF ou image)
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Autorisation d'ouverture</label>
                            <div class="file-upload">
                                <input type="file" id="authorizationFile2" accept=".pdf,image/*">
                                <label for="authorizationFile2">
                                    üìÑ T√©l√©charger l'autorisation (PDF ou image)
                                </label>
                            </div>
                        </div>

                        <h3 style="margin-top: 30px;">‚úÖ Validation L√©gale</h3>

                        <div class="form-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="attestation1" required>
                                <label for="attestation1">J'atteste que toutes les informations fournies sont exactes *</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="attestation2" required>
                                <label for="attestation2">J'autorise la plateforme √† v√©rifier l'authenticit√© de l'√©tablissement *</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="cgu" required>
                                <label for="cgu">J'accepte les Conditions G√©n√©rales d'Utilisation (CGU) *</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="privacy" required>
                                <label for="privacy">J'accepte la Politique de Confidentialit√© *</label>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" onclick="previousStep(4)">
                                ‚Üê Pr√©c√©dent
                            </button>
                            <button type="submit" class="btn btn-primary">
                                üè• Cr√©er le compte
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="js/auth-guard.js"></script>
    <script>
        let currentStep = 1;
        const totalSteps = 4;

        function switchTab(tab) {
            const tabs = document.querySelectorAll('.auth-tab');
            const forms = document.querySelectorAll('.auth-form');
            
            tabs.forEach(t => t.classList.remove('active'));
            forms.forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                tabs[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                tabs[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        function nextStep(step) {
            if (validateStep(step)) {
                document.getElementById(`section${step}`).style.display = 'none';
                document.getElementById(`step${step}`).classList.remove('active');
                document.getElementById(`step${step}`).classList.add('completed');
                
                currentStep = step + 1;
                document.getElementById(`section${currentStep}`).style.display = 'block';
                document.getElementById(`step${currentStep}`).classList.add('active');
            }
        }

        function previousStep(step) {
            document.getElementById(`section${step}`).style.display = 'none';
            document.getElementById(`step${step}`).classList.remove('active');
            
            currentStep = step - 1;
            document.getElementById(`section${currentStep}`).style.display = 'block';
            document.getElementById(`step${currentStep}`).classList.add('active');
            document.getElementById(`step${currentStep}`).classList.remove('completed');
        }

        function validateStep(step) {
            let isValid = true;
            const section = document.getElementById(`section${step}`);
            const requiredFields = section.querySelectorAll('[required]');
            
            // R√©initialiser les styles
            requiredFields.forEach(field => {
                field.style.borderColor = '#e0e0e0';
            });
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.style.borderColor = '#e74c3c';
                    field.style.backgroundColor = '#fff5f5';
                    
                    // Afficher un message d'erreur
                    let errorMsg = field.parentNode.querySelector('.error-message');
                    if (!errorMsg) {
                        errorMsg = document.createElement('div');
                        errorMsg.className = 'error-message';
                        errorMsg.style.display = 'block';
                        errorMsg.style.color = '#e74c3c';
                        errorMsg.style.fontSize = '0.9rem';
                        errorMsg.style.marginTop = '5px';
                        field.parentNode.appendChild(errorMsg);
                    }
                    errorMsg.textContent = 'Ce champ est obligatoire';
                } else {
                    field.style.backgroundColor = 'white';
                    
                    // Cacher le message d'erreur
                    let errorMsg = field.parentNode.querySelector('.error-message');
                    if (errorMsg) {
                        errorMsg.style.display = 'none';
                    }
                    
                    // Validation sp√©cifique pour certains champs
                    if (field.type === 'email' && !validateEmail(field.value)) {
                        isValid = false;
                        field.style.borderColor = '#e74c3c';
                        field.style.backgroundColor = '#fff5f5';
                        
                        let errorMsg = field.parentNode.querySelector('.error-message');
                        if (!errorMsg) {
                            errorMsg = document.createElement('div');
                            errorMsg.className = 'error-message';
                            errorMsg.style.display = 'block';
                            errorMsg.style.color = '#e74c3c';
                            errorMsg.style.fontSize = '0.9rem';
                            errorMsg.style.marginTop = '5px';
                            field.parentNode.appendChild(errorMsg);
                        }
                        errorMsg.textContent = 'Veuillez entrer une adresse email valide';
                    }
                    
                    if (field.type === 'tel' && !validatePhone(field.value)) {
                        isValid = false;
                        field.style.borderColor = '#e74c3c';
                        field.style.backgroundColor = '#fff5f5';
                        
                        let errorMsg = field.parentNode.querySelector('.error-message');
                        if (!errorMsg) {
                            errorMsg = document.createElement('div');
                            errorMsg.className = 'error-message';
                            errorMsg.style.display = 'block';
                            errorMsg.style.color = '#e74c3c';
                            errorMsg.style.fontSize = '0.9rem';
                            errorMsg.style.marginTop = '5px';
                            field.parentNode.appendChild(errorMsg);
                        }
                        errorMsg.textContent = 'Veuillez entrer un num√©ro de t√©l√©phone valide';
                    }
                }
            });
            
            // Validation des checkboxes pour les sp√©cialit√©s et services
            if (step === 3) {
                const specialties = section.querySelectorAll('input[type="checkbox"][id*="cardio"], input[type="checkbox"][id*="pediatrie"], input[type="checkbox"][id*="urgences"], input[type="checkbox"][id*="gyneco"], input[type="checkbox"][id*="neurologie"], input[type="checkbox"][id*="orthopedie"]');
                const services = section.querySelectorAll('input[type="checkbox"][id*="labo"], input[type="checkbox"][id*="imagerie"], input[type="checkbox"][id*="pharmacie"], input[type="checkbox"][id*="ambulance"], input[type="checkbox"][id*="bloc_operatoire"]');
                
                let hasSpecialty = false;
                let hasService = false;
                
                specialties.forEach(cb => { if (cb.checked) hasSpecialty = true; });
                services.forEach(cb => { if (cb.checked) hasService = true; });
                
                if (!hasSpecialty) {
                    isValid = false;
                    alert('Veuillez s√©lectionner au moins une sp√©cialit√© disponible.');
                }
                
                if (!hasService) {
                    isValid = false;
                    alert('Veuillez s√©lectionner au moins un service disponible.');
                }
            }
            
            if (!isValid) {
                // Faire d√©filer jusqu'au premier champ invalide
                const firstInvalid = section.querySelector('[style*="border-color: rgb(231, 76, 60)"]');
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstInvalid.focus();
                }
            }
            
            return isValid;
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validatePhone(phone) {
            const re = /^[\+]?[(]?[0-9]{1,4}[)]?[-\s\.]?[(]?[0-9]{1,4}[)]?[-\s\.]?[0-9]{1,9}$/;
            return re.test(phone);
        }

        function checkPasswordStrength() {
            const password = document.getElementById('adminPassword').value;
            const strengthBar = document.getElementById('passwordStrengthBar');
            
            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]/)) strength++;
            if (password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;
            
            strengthBar.className = 'password-strength-bar';
            if (strength <= 2) {
                strengthBar.classList.add('weak');
            } else if (strength <= 4) {
                strengthBar.classList.add('medium');
            } else {
                strengthBar.classList.add('strong');
            }
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        document.getElementById('latitude').value = position.coords.latitude;
                        document.getElementById('longitude').value = position.coords.longitude;
                    },
                    error => {
                        alert('Impossible d\'obtenir votre position. Veuillez entrer les coordonn√©es manuellement.');
                    }
                );
            } else {
                alert('La g√©olocalisation n\'est pas support√©e par votre navigateur.');
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Utilisateur de d√©monstration
            if (email === 'hopital@demo.com' && password === 'motdepasse') {
                // Cr√©er la session d'authentification
                authGuard.login(email, 'H√¥pital Principal de Dakar');
                
                // Rediriger vers le dashboard
                window.location.href = 'index.html';
                return;
            }
            
            // Simulation de connexion pour autres utilisateurs
            if (email && password) {
                // V√©rifier si c'est l'email de d√©mo avec mauvais mot de passe
                if (email === 'hopital@demo.com') {
                    document.getElementById('loginPassword').style.borderColor = '#e74c3c';
                    document.getElementById('loginPassword').style.backgroundColor = '#fff5f5';
                    alert('Mot de passe incorrect. Utilisez: motdepasse');
                    return;
                }
                
                // Cr√©er la session d'authentification pour autres utilisateurs
                authGuard.login(email, email.split('@')[0]);
                
                // Rediriger vers le dashboard
                window.location.href = 'index.html';
            } else {
                // Afficher erreurs
                if (!email) {
                    document.getElementById('loginEmail').style.borderColor = '#e74c3c';
                    document.getElementById('loginEmail').style.backgroundColor = '#fff5f5';
                }
                if (!password) {
                    document.getElementById('loginPassword').style.borderColor = '#e74c3c';
                    document.getElementById('loginPassword').style.backgroundColor = '#fff5f5';
                }
                alert('Veuillez remplir tous les champs.');
            }
        }

        function handleRegister(event) {
            event.preventDefault();
            
            console.log('handleRegister appel√©');
            
            // Validation finale de toutes les √©tapes
            let allValid = true;
            for (let i = 1; i <= 4; i++) {
                if (!validateStep(i)) {
                    allValid = false;
                    // Afficher l'√©tape qui a √©chou√©
                    document.getElementById(`section${currentStep}`).style.display = 'none';
                    document.getElementById(`step${currentStep}`).classList.remove('active');
                    currentStep = i;
                    document.getElementById(`section${i}`).style.display = 'block';
                    document.getElementById(`step${i}`).classList.add('active');
                    break;
                }
            }
            
            if (!allValid) {
                console.log('Validation √©chou√©e');
                return;
            }
            
            console.log('Validation r√©ussie, traitement des donn√©es...');
            
            const password = document.getElementById('adminPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                document.getElementById('passwordMatchError').textContent = 'Les mots de passe ne correspondent pas.';
                document.getElementById('passwordMatchError').style.display = 'block';
                document.getElementById('confirmPassword').style.borderColor = '#e74c3c';
                document.getElementById('confirmPassword').style.backgroundColor = '#fff5f5';
                return;
            }
            
            if (password.length < 8) {
                alert('Le mot de passe doit contenir au moins 8 caract√®res.');
                return;
            }
            
            // V√©rifier que les cases l√©gales sont coch√©es
            const requiredCheckboxes = ['attestation1', 'attestation2', 'cgu', 'privacy'];
            for (let checkboxId of requiredCheckboxes) {
                const checkbox = document.getElementById(checkboxId);
                if (!checkbox.checked) {
                    alert('Veuillez accepter toutes les conditions l√©gales pour continuer.');
                    checkbox.style.borderColor = '#e74c3c';
                    checkbox.style.backgroundColor = '#fff5f5';
                    return;
                }
            }
            
            // Collecter toutes les donn√©es du formulaire
            const formData = {
                hospital: {
                    name: document.getElementById('hospitalName').value,
                    type: document.getElementById('hospitalType').value,
                    agreementNumber: document.getElementById('agreementNumber').value,
                    creationYear: document.getElementById('creationYear').value,
                    legalStatus: document.getElementById('legalStatus').value
                },
                contact: {
                    address: document.getElementById('fullAddress').value,
                    region: document.getElementById('region').value,
                    city: document.getElementById('city').value,
                    postalCode: document.getElementById('postalCode').value,
                    phone: document.getElementById('mainPhone').value,
                    email: document.getElementById('officialEmail').value,
                    website: document.getElementById('website').value,
                    latitude: document.getElementById('latitude').value,
                    longitude: document.getElementById('longitude').value
                },
                manager: {
                    name: document.getElementById('managerName').value,
                    position: document.getElementById('managerPosition').value,
                    phone: document.getElementById('managerPhone').value,
                    email: document.getElementById('managerEmail').value
                },
                operations: {
                    bedCapacity: document.getElementById('bedCapacity').value,
                    doctorCount: document.getElementById('doctorCount').value,
                    nurseCount: document.getElementById('nurseCount').value,
                    employeeCount: document.getElementById('employeeCount').value
                },
                admin: {
                    name: document.getElementById('adminName').value,
                    email: document.getElementById('adminEmail').value,
                    password: password,
                    enable2FA: document.getElementById('enable2FA').checked
                }
            };
            
            console.log('Donn√©es d\'inscription:', formData);
            
            // Sauvegarder les donn√©es pour la page de succ√®s
            const registrationData = {
                hospitalName: formData.hospital.name,
                hospitalId: `BL-${new Date().getFullYear()}-HPD-${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}`,
                adminEmail: formData.admin.email,
                registrationDate: new Date().toLocaleDateString('fr-FR')
            };
            
            console.log('Donn√©es de succ√®s:', registrationData);
            
            localStorage.setItem('hospitalRegistration', JSON.stringify(registrationData));
            
            console.log('Redirection vers register-success.html...');
            
            // Rediriger vers la page de succ√®s
            setTimeout(() => {
                window.location.href = 'register-success.html';
            }, 100);
        }

        function showPasswordReset() {
            alert('Fonctionnalit√© de r√©initialisation de mot de passe √† impl√©menter.');
        }

        // Nettoyer les erreurs lors de la saisie
        document.querySelectorAll('input, select, textarea').forEach(field => {
            field.addEventListener('input', function() {
                this.style.borderColor = '#e0e0e0';
                this.style.backgroundColor = 'white';
                const errorMsg = this.parentNode.querySelector('.error-message');
                if (errorMsg) {
                    errorMsg.style.display = 'none';
                }
            });
            
            field.addEventListener('change', function() {
                if (this.type === 'checkbox') {
                    this.style.borderColor = '#e0e0e0';
                    this.style.backgroundColor = 'white';
                }
            });
        });
    </script>
</body>
</html>
